{% extends "almuerzo/base.html" %}

{% block content %}
    
  <h1>Buscar servicios por fecha y sección</h1>

  <form method="get" id="filtro-form">
    <p>
      <label for="{{ form.fecha.id_for_label }}">Fecha:</label>
      {{ form.fecha }}
    </p>
    <p>
      <label for="{{ form.carrera.id_for_label }}">Carrera:</label>
      {{ form.carrera }}
    </p>
    <p>
      <label for="{{ form.seccion.id_for_label }}">Sección:</label>
      {{ form.seccion }}
    </p>
    <button class="btn-primary" type="submit">Buscar</button>
  </form>

  <hr>

  {% if estudiantes is not None %}
    {% if estudiantes %}
      <h2>Estudiantes con servicio</h2>
      <ul>
        {% for e in estudiantes %}
          <li>{{ e.apellido }}, {{ e.nombre }} — {{ e.seccion.nombre }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No se encontraron estudiantes para esa fecha y sección.</p>
    {% endif %}
  {% endif %}

  <script>
    // Cuando cambia la carrera, reenviar el formulario para repoblar "sección"
    const carreraSelect = document.getElementById("id_carrera");
    if (carreraSelect) {
      carreraSelect.addEventListener("change", function () {
        // Limpia valor de sección antes de enviar, para que se regenere correctamente
        const seccionSelect = document.getElementById("id_seccion");
        if (seccionSelect) seccionSelect.selectedIndex = -1;
        document.getElementById("filtro-form").submit();
      });
    }
  </script>


    
    
{% endblock %}
